<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>School Pictures Form</title>
    <style>
      .hidden {
        display: none;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
        display: flex;
        justify-content: center;
        align-items: center;
        height: auto;
        padding: 5rem 0;
        margin: 0;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        width: 400px;
      }
      label {
        font-weight: bold;
        display: block;
        margin-top: 10px;
      }
      input,
      select,
      button {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button {
        background-color: #000;
        color: white;
        font-size: 16px;
        margin-top: 15px;
        cursor: pointer;
      }
      h3 {
        text-align: center;
      }

      .print-tag-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        flex-wrap: wrap;
        justify-content: start;
      }

      .print-tag {
        display: inline-block;
        padding: 2px 6px;
        background-color: #f0f0f0;
        font-size: 13px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
        user-select: none;
      }

      .print-tag.selected {
        background-color: #007bff;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>School Pictures Form</h2>
      <form id="photoForm">
        <label>
          Parent Name: First, Last*
          <input type="text" name="parentName" required="" />
        </label>
        <label>
          Parent Email Address*
          <input type="email" name="parentEmail" required="" />
        </label>
        <label>
          Parent Phone Number*
          <input type="tel" name="parentPhone" required="" />
        </label>
        <label>
          How Many Children Are You Having Photographed*
          <select id="childCount" name="childCount" required="">
            <option value="1" selected>1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </label>
        <div id="childrenContainer">
          <label>
            Name of Child 1*
            <input type="text" name="childName1" required />
          </label>
          <label>
            Grade of Child 1*
            <input type="text" name="childGrade1" required />
          </label>
        </div>
        <label id="sameClassContainer">
          Are the children in the same class?*
          <select id="sameClass" name="sameClass">
            <option value="Yes" selected>Yes</option>
            <option value="No">No</option>
          </select>
        </label>
        <label>
          Do you want your child's class photo as well?*
          <select id="classPhoto" name="classPhoto">
            <option value="Yes" selected>Yes</option>
            <option value="No">No</option>
          </select>
        </label>
        <label id="classSelectFormat">
          Class Photo Format*
          <select id="classPhotoType" name="classPhotoType">
            <option value="digitalDownloads" selected>Digital Downloads</option>
            <option value="printedPhotos">Printed Photos</option>
            <option value="Both">Both</option>
          </select>
        </label>

        <div id="classPrintPackageContainer">
          <label>Class Photo Print Package*</label>
          <div class="class-print-tag-container print-tag-container"></div>
        </div>
        <label>
          Do You Want Individual Portraits of Your Child?
          <select id="individualPortraits" name="individualPortraits">
            <option value="Yes" selected>Yes</option>
            <option value="No">No</option>
          </select>
        </label>
        <label id="individualSelectFormat">
          Individual Portrait Photo Format*
          <select id="individualPhotoType" name="individualPhotoType">
            <option value="digitalDownloads" selected>Digital Downloads</option>
            <option value="printedPhotos">Printed Photos</option>
            <option value="Both">Both</option>
          </select>
        </label>

        <div id="individualPrintPackageContainer">
          <label>Individual Portrait Print Package*</label>
          <div class="individual-print-tag-container print-tag-container"></div>
        </div>
        <label>
          Photo Style*
          <select id="photoStyle" name="photoStyle">
            <option value="Traditional" selected>Traditional</option>
            <option value="Characteristic">Characteristic</option>
            <option value="Both">Both</option>
          </select>
        </label>

        <label for="shippingAddress">
          Shipping Address*
          <input type="text" id="shippingAddress" name="shippingAddress" />
        </label>

        <h4>Breakdown:</h4>
        <p>Digital Download Price: $<span id="digitalPrice">0.00</span></p>
        <p>Print Package Price: $<span id="printPrice">0.00</span></p>
        <h3>Total Price: $<span class="totalPrice">0.00</span></h3>
        <button type="submit">
          Submit - $<span class="totalPrice">0.00</span>
        </button>
      </form>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#sameClassContainer").hide();

        function toggleShippingAddress() {
          const hasPrints = $(".print-tag.selected").length > 0;
          if (hasPrints) {
            $("input[name='shippingAddress']").prop("required", true);
            $("label[for='shippingAddress']").show();
          } else {
            $("input[name='shippingAddress']").prop("required", false);
            $("label[for='shippingAddress']").hide();
          }
        }

        function togglePrintPackageFields() {
          const individualPortraits = $("#individualPortraits").val();
          const individualPhotoType = $("#individualPhotoType").val();

          if (individualPortraits === "Yes") {
            $("#individualSelectFormat").show();
          } else {
            $("#individualSelectFormat").hide();
          }

          if (
            individualPhotoType === "printedPhotos" ||
            individualPhotoType === "Both"
          ) {
            $("#individualPrintPackageContainer").show();
          } else {
            $("#individualPrintPackageContainer").hide();
          }

          const classPhoto = $("#classPhoto").val();
          const classPhotoType = $("#classPhotoType").val();

          if (classPhoto === "Yes") {
            $("#classSelectFormat").show();
          } else {
            $("#classSelectFormat").hide();
          }

          if (
            classPhoto === "Yes" &&
            (classPhotoType === "printedPhotos" || classPhotoType === "Both")
          ) {
            $("#classPrintPackageContainer").show();
          } else {
            $("#classPrintPackageContainer").hide();
          }
        }
        $("#childCount").on("change", function () {
          let childCount = parseInt($(this).val());
          let $childrenContainer = $("#childrenContainer");
          $childrenContainer.empty();

          if (childCount > 1) {
            $("#sameClassContainer").show();
          } else {
            $("#sameClassContainer").hide();
          }

          for (let i = 1; i <= childCount; i++) {
            let childDiv = $(`
              <div>
                <label> Name of Child ${i}*
                  <input type="text" name="childName${i}" required />
                </label>
                <label> Grade of Child ${i}*
                  <input type="text" name="childGrade${i}" required />
                </label>
              </div>
            `);
            $childrenContainer.append(childDiv);
          }
        });

        $("#photoType").on("change", function () {
          let photoType = $(this).val();
          if (photoType === "Both" || photoType === "printedPhotos") {
            $("#printPackageContainer").show();
          } else {
            $("#printPackageContainer").hide();
          }
          calculatePrice();
        });

        const printPackages = [
          { name: "8 Up Wallet - Glossy", price: 8.0 },
          { name: "8 Up Wallet - Deep Matte", price: 9.0 },
          { name: "4x6 - Glossy", price: 3.0 },
          { name: "4x6 - Deep Matte", price: 4.0 },
          { name: "5x7 - Glossy", price: 5.0 },
          { name: "5x7 - Deep Matte", price: 6.0 },
          { name: "8x10 - Glossy", price: 7.0 },
          { name: "8x10 - Deep Matte", price: 9.0 },
          { name: "8x12 - Glossy", price: 13.0 },
          { name: "8x12 - Deep Matte", price: 15.0 },
          { name: "11x14 - Glossy", price: 14.0 },
          { name: "11x14 - Deep Matte", price: 17.0 },
          { name: "12x18 - Glossy", price: 19.0 },
          { name: "12x18 - Deep Matte", price: 24.0 },
          { name: "16x20 - Glossy", price: 35.0 },
          { name: "16x20 - Deep Matte", price: 43.0 },
        ];

        let $classPrintContainer = $(".class-print-tag-container");

        printPackages.forEach((pkg, index) => {
          $classPrintContainer.append(`
              <div>
                <span class="print-tag class-print-tag" data-price="${
                  pkg.price
                }" data-index="${index}">
      ${pkg.name} - $${pkg.price.toFixed(2)}
    </span>
              </div>
            `);
        });
        let $printIndividualContainer = $(".individual-print-tag-container");

        printPackages.forEach((pkg, index) => {
          $printIndividualContainer.append(`
              <div>
                <span class="print-tag individual-print-tag" data-price="${
                  pkg.price
                }" data-index="${index}">
      ${pkg.name} - $${pkg.price.toFixed(2)}
    </span>
              </div>
            `);
        });

        $("#photoForm").on("change", calculatePrice);
        $(".print-checkbox").on("change", calculatePrice);

        function calculatePrice() {
          let childCount = parseInt($("#childCount").val()) || 1;
          let photoStyle = $("#photoStyle").val();
          let individualPortraits = $("#individualPortraits").val();
          let classPhoto = $("#classPhoto").val();
          let sameClass = $("#sameClass").val();
          let poses = photoStyle === "Both" ? 2 : 1;

          let digitalPrice = 0;
          let printPrice = 0;

          // Individual Portraits Calculations
          if (individualPortraits === "Yes") {
            const individualPhotoType = $("#individualPhotoType").val();

            // Digital calculations
            if (
              individualPhotoType === "digitalDownloads" ||
              individualPhotoType === "Both"
            ) {
              digitalPrice += childCount * poses * 22;
            }

            // Print calculations
            if (
              individualPhotoType === "printedPhotos" ||
              individualPhotoType === "Both"
            ) {
              $(".individual-print-tag.selected").each(function () {
                let price = parseFloat($(this).data("price"));
                printPrice += childCount * poses * price;
              });
            }
          }

          // Class Photo Calculations
          if (classPhoto === "Yes") {
            const classPhotoType = $("#classPhotoType").val();
            const classMultiplier = sameClass === "Yes" ? 1 : childCount;

            // Digital calculations
            if (
              classPhotoType === "digitalDownloads" ||
              classPhotoType === "Both"
            ) {
              digitalPrice += classMultiplier * poses * 22;
            }

            // Print calculations
            if (
              classPhotoType === "printedPhotos" ||
              classPhotoType === "Both"
            ) {
              $(".class-print-tag.selected").each(function () {
                let price = parseFloat($(this).data("price"));
                printPrice += classMultiplier * poses * price;
              });
            }
          }

          let total = digitalPrice + printPrice;
          $("#digitalPrice").text(digitalPrice.toFixed(2));
          $("#printPrice").text(printPrice.toFixed(2));
          $(".totalPrice").text(total.toFixed(2));
        }

        $(document).on(
          "change",
          "#individualPortraits, #individualPhotoType, #classPhoto, #classPhotoType",
          function () {
            togglePrintPackageFields();
            calculatePrice();
          }
        );
        $(document).on("click", ".print-tag", function () {
          $(this).toggleClass("selected");
          toggleShippingAddress();
          calculatePrice();
        });

        function validateFormOptions() {
          const classPhoto = $("#classPhoto").val();
          const individualPortraits = $("#individualPortraits").val();

          if (classPhoto === "No" && individualPortraits === "No") {
            alert(
              "Please select 'Yes' for at least one option: Class Photo or Individual Portraits."
            );
            return false;
          }
          return true;
        }
        $("#photoForm").on("submit", function (e) {
          e.preventDefault();
          const form = e.target;

          if (!validateFormOptions()) {
            return;
          }

          // Trigger HTML5 validation
          if (!form.checkValidity()) {
            form.reportValidity();
            return;
          }

          // Collect basic form data
          const formData = $(this)
            .serializeArray()
            .reduce((acc, field) => {
              acc[field.name] = field.value;
              return acc;
            }, {});

          // Collect children's data
          const children = [];
          const childCount = parseInt(formData.childCount);
          for (let i = 1; i <= childCount; i++) {
            children.push({
              name: formData[`childName${i}`],
              grade: formData[`childGrade${i}`],
            });
          }

          // Collect print package selections
          const printSelections = {
            individual: $(".individual-print-tag.selected")
              .map(function () {
                return {
                  package: $(this).text().trim(),
                  price: parseFloat($(this).data("price")),
                };
              })
              .get(),
            class: $(".class-print-tag.selected")
              .map(function () {
                return {
                  package: $(this).text().trim(),
                  price: parseFloat($(this).data("price")),
                };
              })
              .get(),
          };

          // Construct final data object
          const submissionData = {
            parentInfo: {
              name: formData.parentName,
              email: formData.parentEmail,
              phone: formData.parentPhone,
            },
            children,
            sameClass: formData.sameClass,
            classPhoto: {
              wanted: formData.classPhoto,
              format: formData.classPhotoType,
              prints: printSelections.class,
            },
            individualPortraits: {
              wanted: formData.individualPortraits,
              format: formData.individualPhotoType,
              prints: printSelections.individual,
            },
            photoStyle: formData.photoStyle,
            shippingAddress: formData.shippingAddress,
            pricing: {
              digital: parseFloat($("#digitalPrice").text()),
              prints: parseFloat($("#printPrice").text()),
              total: parseFloat($(".totalPrice").text()),
            },
          };

          console.log("Form Submission Data:", submissionData);

          const emailFormat = `
           School Pictures Order Summary:
    -----------------------------
    Parent Information:
    - Name: ${submissionData.parentInfo.name}
    - Email: ${submissionData.parentInfo.email}
    - Phone: ${submissionData.parentInfo.phone}

    Children Information:
    ${submissionData.children
      .map(
        (child, index) => `
    Child ${index + 1}:
    - Name: ${child.name}
    - Grade: ${child.grade}`
      )
      .join("\n")}

    Class Photo:
    - Wanted: ${submissionData.classPhoto.wanted}
    - Format: ${
      submissionData.classPhoto.wanted === "Yes"
        ? submissionData.classPhoto.format
        : "N/A"
    }
    ${
      submissionData.classPhoto.prints.length > 0
        ? `- Selected Print Packages:
    ${submissionData.classPhoto.prints
      .map((pkg) => `  • ${pkg.package}`)
      .join("\n")}`
        : ""
    }

    Individual Portraits:
    - Wanted: ${submissionData.individualPortraits.wanted}
    - Format: ${
      submissionData.individualPortraits.wanted === "Yes"
        ? submissionData.individualPortraits.format
        : "N/A"
    }
    ${
      submissionData.individualPortraits.prints.length > 0
        ? `- Selected Print Packages:
    ${submissionData.individualPortraits.prints
      .map((pkg) => `  • ${pkg.package}`)
      .join("\n")}`
        : ""
    }

    Photo Style: ${submissionData.photoStyle}

    ${
      submissionData.shippingAddress
        ? `Shipping Address: ${submissionData.shippingAddress}`
        : ""
    }

    Pricing Summary:
    - Digital Downloads: $${submissionData.pricing.digital.toFixed(2)}
    - Print Packages: $${submissionData.pricing.prints.toFixed(2)}
    - Total: $${submissionData.pricing.total.toFixed(2)}
  `;

          // Display email-friendly format on the page
          const resultContainer = $("<div>")
            .addClass("container")
            .css({
              "margin-top": "20px",
              "background-color": "#f0f0f0",
              padding: "20px",
            })
            .html(`<pre>${emailFormat}</pre>`);

          $("body").append(resultContainer);

          // Scroll to the result
          $("html, body").animate(
            {
              scrollTop: resultContainer.offset().top,
            },
            1000
          );
        });
        toggleShippingAddress();
        togglePrintPackageFields();
        calculatePrice();
      });
    </script>
  </body>
</html>
